<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Pausenverwaltung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            color-scheme: light;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            --brand-primary: #1671ff;
            --brand-primary-dark: #0f54c4;
            --brand-success: #2f9e44;
            --brand-danger: #d64545;
            --surface: #ffffff;
            --surface-muted: #f4f6fb;
            --border: #d8deec;
            --text: #1a1c24;
            --text-muted: #596178;
            --shadow: 0 18px 40px -24px rgba(22, 113, 255, 0.45);
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(150deg, #eef3ff 0%, #f9fbff 50%, #f4f7fb 100%);
            color: var(--text);
        }

        .page {
            max-width: 1100px;
            margin: 0 auto;
            padding: 3.5rem 1.5rem 3rem;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
        }

        .page-header h1 {
            margin: 0;
            font-size: clamp(1.9rem, 2.5vw, 2.55rem);
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .page-header .subtitle {
            margin: 0.35rem 0 0;
            color: var(--text-muted);
            font-size: 1rem;
        }

        .api-badge {
            background: rgba(22, 113, 255, 0.08);
            color: var(--brand-primary);
            border: 1px solid rgba(22, 113, 255, 0.18);
            padding: 0.45rem 0.9rem;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .layout {
            margin-top: 2.25rem;
            display: grid;
            gap: 1.5rem;
        }

        .panel {
            background: var(--surface);
            border-radius: 18px;
            padding: 1.85rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(216, 222, 236, 0.55);
        }

        .panel h2 {
            margin: 0 0 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem 1.25rem;
            align-items: end;
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 0.45rem;
            font-size: 0.82rem;
            font-weight: 600;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .field input {
            height: 2.8rem;
            padding: 0 1rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: 0.98rem;
            background: var(--surface-muted);
            color: var(--text);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .field input:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 3px rgba(22, 113, 255, 0.15);
            background: #fff;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            border-radius: 12px;
            padding: 0.65rem 1.15rem;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease;
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        .btn-primary {
            background: var(--brand-primary);
            color: #fff;
            box-shadow: 0 14px 28px -16px rgba(22, 113, 255, 0.7);
        }

        .btn-primary:hover {
            background: var(--brand-primary-dark);
            transform: translateY(-1px);
        }

        .btn-muted {
            background: rgba(89, 97, 120, 0.12);
            color: var(--text);
        }

        .btn-muted:hover {
            background: rgba(89, 97, 120, 0.2);
        }

        .btn-danger {
            background: rgba(214, 69, 69, 0.12);
            color: var(--brand-danger);
        }

        .btn-danger:hover {
            background: rgba(214, 69, 69, 0.2);
        }

        .message-area {
            margin-top: 1.35rem;
            min-height: 3rem;
        }

        .alert {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            padding: 0.9rem 1.05rem;
            border-radius: 12px;
            border: 1px solid transparent;
            background: rgba(22, 113, 255, 0.12);
            color: var(--brand-primary);
            font-weight: 500;
            animation: fade-in 0.18s ease;
        }

        .alert button {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
        }

        .alert-success {
            background: rgba(47, 158, 68, 0.1);
            border-color: rgba(47, 158, 68, 0.2);
            color: var(--brand-success);
        }

        .alert-error {
            background: rgba(214, 69, 69, 0.12);
            border-color: rgba(214, 69, 69, 0.24);
            color: var(--brand-danger);
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .table-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .status-line {
            font-size: 0.92rem;
            color: var(--text-muted);
        }

        .table-container {
            margin-top: 1rem;
            overflow: hidden;
            border-radius: 14px;
            border: 1px solid rgba(216, 222, 236, 0.6);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
        }

        thead {
            background: rgba(22, 113, 255, 0.08);
        }

        th {
            text-align: left;
            padding: 1rem;
            font-size: 0.82rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        td {
            padding: 0.85rem 1rem;
            border-top: 1px solid rgba(216, 222, 236, 0.6);
            vertical-align: middle;
        }

        tbody tr:hover {
            background: rgba(22, 113, 255, 0.04);
        }

        tbody tr.is-active {
            background: rgba(22, 113, 255, 0.12);
            box-shadow: inset 3px 0 0 rgba(22, 113, 255, 0.5);
        }

        tbody tr.has-error {
            background: rgba(214, 69, 69, 0.08);
        }

        td input {
            width: 100%;
            height: 2.45rem;
            border-radius: 10px;
            border: 1px solid var(--border);
            padding: 0 0.75rem;
            background: var(--surface-muted);
            font-size: 0.95rem;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        td input:focus {
            outline: none;
            border-color: var(--brand-primary);
            background: #fff;
            box-shadow: 0 0 0 2px rgba(22, 113, 255, 0.15);
        }

        tbody tr.has-error input {
            border-color: rgba(214, 69, 69, 0.8);
            background: rgba(214, 69, 69, 0.12);
        }

        .actions {
            display: inline-flex;
            flex-wrap: wrap;
            gap: 0.45rem;
        }

        .revisions-panel {
            position: relative;
        }

        .revisions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.2rem;
        }

        .revisions-header h2 {
            margin-bottom: 0.25rem;
        }

        .revisions-meta {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .timeline {
            margin: 1.6rem 0 0;
            padding: 0;
            list-style: none;
            position: relative;
        }

        .timeline::before {
            content: "";
            position: absolute;
            inset: 0 auto 0 12px;
            width: 2px;
            background: rgba(22, 113, 255, 0.18);
        }

        .timeline-item {
            padding-left: 2.8rem;
            position: relative;
            margin-bottom: 1.4rem;
        }

        .timeline-dot {
            position: absolute;
            left: 6px;
            top: 0.35rem;
            width: 11px;
            height: 11px;
            border-radius: 999px;
            background: var(--surface);
            border: 3px solid rgba(22, 113, 255, 0.35);
        }

        .timeline-title {
            font-weight: 600;
            color: var(--text);
        }

        .timeline-meta {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.35rem;
        }

        .timeline-actions {
            margin-top: 0.75rem;
        }

        .timeline-empty {
            color: var(--text-muted);
            font-style: italic;
        }

        @media (max-width: 880px) {
            .page {
                padding: 2.8rem 1.25rem 2.5rem;
            }
        }

        @media (max-width: 720px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            thead {
                display: none;
            }
            table tr {
                display: block;
                padding: 1rem;
            }
            table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                border: none;
                border-top: 1px solid rgba(216, 222, 236, 0.45);
            }
            table td::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--text-muted);
                margin-right: 1.25rem;
            }
            table td:first-of-type {
                border-top: none;
            }
            table td input {
                max-width: 60%;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <header class="page-header">
            <div>
                <h1>Pausenverwaltung</h1>
                <p class="subtitle">Verwalten Sie Pausenzeiten und behalten Sie Änderungen im Blick.</p>
            </div>
            <span class="api-badge">API v{{ api_version }}</span>
        </header>

        <main class="layout">
            <section class="panel">
                <h2>Neue Pause anlegen</h2>
                <form id="create-form">
                    <div class="form-grid">
                        <label class="field">
                            Start
                            <input type="time" id="create-start" required>
                        </label>
                        <label class="field">
                            Ende
                            <input type="time" id="create-end" required>
                        </label>
                        <label class="field" style="grid-column: span 2;">
                            Beschreibung
                            <input type="text" id="create-description" placeholder="z. B. Schichtwechsel">
                        </label>
                        <div>
                            <button type="submit" class="btn btn-primary">
                                <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 3V17M3 10H17" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                                </svg>
                                Pause anlegen
                            </button>
                        </div>
                    </div>
                </form>
                <div class="message-area" id="message"></div>
            </section>

            <section class="panel">
                <div class="table-header">
                    <h2>Aktive Pausen</h2>
                    <span id="last-updated" class="status-line"></span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Start</th>
                                <th>Ende</th>
                                <th>Beschreibung</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="breaks-body"></tbody>
                    </table>
                </div>
            </section>

            <section class="panel revisions-panel" id="revisions-panel" hidden>
                <div class="revisions-header">
                    <div>
                        <h2>Änderungshistorie</h2>
                        <p class="revisions-meta" id="revision-title"></p>
                    </div>
                    <button class="btn btn-muted" id="revisions-close">
                        <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 6L14 14M14 6L6 14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                        </svg>
                        Schließen
                    </button>
                </div>
                <ol class="timeline" id="revision-log"></ol>
            </section>
        </main>
    </div>

    <script>
        const messageEl = document.getElementById("message");
        const breaksBody = document.getElementById("breaks-body");
        const revisionsPanel = document.getElementById("revisions-panel");
        const revisionTitle = document.getElementById("revision-title");
        const revisionLog = document.getElementById("revision-log");
        const lastUpdatedEl = document.getElementById("last-updated");
        const revisionsCloseBtn = document.getElementById("revisions-close");
        const createForm = document.getElementById("create-form");
        const createStartInput = document.getElementById("create-start");
        const createEndInput = document.getElementById("create-end");

        let lastLoadedAt = null;
        let allBreaks = [];
        let activeHighlightTimer = null;

        async function apiRequest(path, options = {}) {
            const response = await fetch(path, {
                headers: {
                    "Content-Type": "application/json",
                },
                ...options,
            });
            let data = null;
            try {
                data = await response.json();
            } catch {
                // ignore JSON parse errors for empty bodies
            }
            if (!response.ok) {
                const message = data && data.error ? data.error : response.statusText;
                throw new Error(message || "Unbekannter Fehler");
            }
            return data;
        }

        function setMessage(text, mode = "success") {
            if (!text) {
                messageEl.innerHTML = "";
                return;
            }

            const alertClass = mode === "error" ? "alert-error" : "alert-success";
            messageEl.innerHTML = `
                <div class="alert ${alertClass}">
                    <span>${text}</span>
                    <button type="button" aria-label="Hinweis ausblenden">&times;</button>
                </div>
            `;
            const closeBtn = messageEl.querySelector("button");
            closeBtn?.addEventListener("click", () => (messageEl.innerHTML = ""));
            setTimeout(() => {
                if (closeBtn && messageEl.contains(closeBtn)) {
                    messageEl.innerHTML = "";
                }
            }, 5000);
        }

        function formatTimestamp(date) {
            return date.toLocaleString("de-DE", {
                day: "2-digit",
                month: "2-digit",
                year: "numeric",
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
            });
        }

        function timeToMinutes(value) {
            if (!value) return 0;
            const [hours, minutes] = value.split(":").map(Number);
            return hours * 60 + minutes;
        }

        function updateLastUpdated() {
            if (!lastLoadedAt) {
                lastUpdatedEl.textContent = "";
                return;
            }
            lastUpdatedEl.textContent = `Zuletzt aktualisiert: ${formatTimestamp(lastLoadedAt)}`;
        }

        function sortBreaks(list) {
            return list.slice().sort((a, b) => (a.start || "").localeCompare(b.start || "", "de"));
        }

        function findActiveBreak(now = new Date()) {
            const currentMinutes = now.getHours() * 60 + now.getMinutes() + now.getSeconds() / 60;
            return allBreaks.find((entry) => {
                const start = timeToMinutes(entry.start);
                const end = timeToMinutes(entry.end);
                return currentMinutes >= start && currentMinutes <= end;
            });
        }

        function refreshActiveHighlight() {
            const active = findActiveBreak();
            breaksBody.querySelectorAll("tr").forEach((row) => {
                const id = Number(row.dataset.breakId);
                row.classList.toggle("is-active", Boolean(active && Number(active.id) === id));
            });
        }

        function startActiveHighlightTimer() {
            if (activeHighlightTimer !== null) {
                return;
            }
            activeHighlightTimer = setInterval(refreshActiveHighlight, 30000);
        }

        function validateTimeWindow(start, end, ignoreId = null, { allowIncomplete = false } = {}) {
            if (!start || !end) {
                if (allowIncomplete) {
                    return { valid: false, pending: true };
                }
                return { valid: false, message: "Bitte Start- und Endzeit angeben." };
            }

            const startMinutes = timeToMinutes(start);
            const endMinutes = timeToMinutes(end);

            if (startMinutes >= endMinutes) {
                return { valid: false, message: "Startzeit muss vor der Endzeit liegen." };
            }

            for (const entry of allBreaks) {
                if (ignoreId !== null && Number(entry.id) === Number(ignoreId)) {
                    continue;
                }
                const entryStart = timeToMinutes(entry.start);
                const entryEnd = timeToMinutes(entry.end);
                const overlaps = Math.max(startMinutes, entryStart) < Math.min(endMinutes, entryEnd);
                if (overlaps) {
                    return {
                        valid: false,
                        message: `Überschneidung mit ${entry.start} – ${entry.end}`,
                    };
                }
            }

            return { valid: true };
        }

        function validateRow(row, { allowIncomplete = false } = {}) {
            const startInput = row.querySelector(".start-input");
            const endInput = row.querySelector(".end-input");
            const breakId = Number(row.dataset.breakId);
            const result = validateTimeWindow(
                startInput.value,
                endInput.value,
                breakId,
                { allowIncomplete }
            );

            if (result.valid) {
                startInput.setCustomValidity("");
                endInput.setCustomValidity("");
                row.classList.remove("has-error");
                return true;
            }

            if (result.pending) {
                startInput.setCustomValidity("");
                endInput.setCustomValidity("");
                row.classList.remove("has-error");
                return false;
            }

            const message = result.message || "Zeitfenster ungültig.";
            startInput.setCustomValidity(message);
            endInput.setCustomValidity(message);
            row.classList.add("has-error");
            return false;
        }

        function validateCreate({ allowIncomplete = false } = {}) {
            const result = validateTimeWindow(
                createStartInput.value,
                createEndInput.value,
                null,
                { allowIncomplete }
            );

            if (result.valid) {
                createStartInput.setCustomValidity("");
                createEndInput.setCustomValidity("");
                return true;
            }

            if (result.pending) {
                createStartInput.setCustomValidity("");
                createEndInput.setCustomValidity("");
                return allowIncomplete;
            }

            const message = result.message || "Zeitfenster ungültig.";
            createStartInput.setCustomValidity(message);
            createEndInput.setCustomValidity(message);
            return false;
        }

        function renderBreaks(list) {
            breaksBody.innerHTML = "";
            const sorted = sortBreaks(list);

            if (!sorted.length) {
                const tr = document.createElement("tr");
                const td = document.createElement("td");
                td.colSpan = 4;
                td.textContent = "Keine Pausen angelegt.";
                td.style.textAlign = "center";
                td.style.color = "var(--text-muted)";
                tr.appendChild(td);
                breaksBody.appendChild(tr);
                return;
            }

            const active = findActiveBreak();
            sorted.forEach((item) => {
                const description = item.description || "";
                const isActive = active && Number(active.id) === Number(item.id);
                const row = document.createElement("tr");
                row.dataset.breakId = item.id;
                row.innerHTML = `
                    <td data-label="Start"><input type="time" value="${item.start}" class="start-input" required></td>
                    <td data-label="Ende"><input type="time" value="${item.end}" class="end-input" required></td>
                    <td data-label="Beschreibung"><input type="text" value="${description.replace(/"/g, "&quot;")}" class="description-input" placeholder="optional"></td>
                    <td data-label="Aktionen">
                        <div class="actions">
                            <button data-action="save" class="btn btn-primary" title="Änderungen speichern">
                                <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M5 11.5L8 14.5L15 7.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Speichern
                            </button>
                            <button data-action="delete" class="btn btn-danger" title="Pause löschen">
                                <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M4 5H16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                                    <path d="M8 4.5V3.5C8 2.948 8.448 2.5 9 2.5H11C11.552 2.5 12 2.948 12 3.5V4.5M15.5 5V15C15.5 15.828 14.828 16.5 14 16.5H6C5.172 16.5 4.5 15.828 4.5 15V5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Löschen
                            </button>
                        </div>
                    </td>
                `;
                if (isActive) {
                    row.classList.add("is-active");
                }
                breaksBody.appendChild(row);
                validateRow(row, { allowIncomplete: true });
            });
        }

        async function loadBreaks() {
            try {
                const data = await apiRequest("/api/breaks");
                allBreaks = data.breaks || [];
                renderBreaks(allBreaks);
                refreshActiveHighlight();
                lastLoadedAt = new Date();
                updateLastUpdated();
            } catch (error) {
                setMessage(error.message, "error");
            }
        }

        async function handleCreate(event) {
            event.preventDefault();
            if (!validateCreate()) {
                createStartInput.reportValidity();
                return;
            }

            const start = createStartInput.value;
            const end = createEndInput.value;
            const description = document.getElementById("create-description").value;
            try {
                await apiRequest("/api/breaks", {
                    method: "POST",
                    body: JSON.stringify({ start, end, description }),
                });
                setMessage("Pause angelegt.");
                event.target.reset();
                await loadBreaks();
            } catch (error) {
                setMessage(error.message, "error");
            }
        }

        async function handleRowAction(event) {
            const button = event.target.closest("button");
            if (!button) return;

            const action = button.dataset.action;
            if (!action) return;

            const row = button.closest("tr");
            const breakId = row ? Number(row.dataset.breakId) : null;
            if (!breakId) return;

            if (action === "save") {
                if (!validateRow(row)) {
                    row.querySelector(".start-input")?.reportValidity();
                    return;
                }
                const start = row.querySelector(".start-input").value;
                const end = row.querySelector(".end-input").value;
                const description = row.querySelector(".description-input").value;
                try {
                    await apiRequest(`/api/breaks/${breakId}`, {
                        method: "PUT",
                        body: JSON.stringify({ start, end, description }),
                    });
                    setMessage("Änderung gespeichert.");
                    await loadBreaks();
                } catch (error) {
                    setMessage(error.message, "error");
                }
            } else if (action === "delete") {
                if (!confirm("Pause wirklich entfernen?")) return;
                try {
                    await apiRequest(`/api/breaks/${breakId}`, { method: "DELETE" });
                    setMessage("Pause entfernt.");
                    await loadBreaks();
                } catch (error) {
                    setMessage(error.message, "error");
                }
            } else if (action === "history") {
                await loadRevisions(breakId);
            }
        }

        function renderRevisions(revisions, breakId) {
            revisionLog.innerHTML = "";
            if (!revisions.length) {
                const li = document.createElement("li");
                li.className = "timeline-empty";
                li.textContent = "Keine Änderungen vorhanden.";
                revisionLog.appendChild(li);
                return;
            }

            revisions.forEach((item) => {
                const li = document.createElement("li");
                li.className = "timeline-item";
                li.dataset.revisionId = item.id;
                li.innerHTML = `
                    <span class="timeline-dot"></span>
                    <div class="timeline-title">${item.change_type}</div>
                    <div class="timeline-meta">
                        ${item.start} – ${item.end}
                        ${item.description ? `· ${item.description}` : ""}
                        ${item.changed_by ? ` · ${item.changed_by}` : ""}
                        · ${formatTimestamp(new Date(item.changed_at))}
                    </div>
                    <div class="timeline-actions">
                        <button class="btn btn-primary" data-action="restore" data-revision-id="${item.id}">
                            <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.5 10.5L5.5 8M5.5 8V13.5M5.5 8H11C13.4853 8 15.5 10.0147 15.5 12.5C15.5 14.9853 13.4853 17 11 17H9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Wiederherstellen
                        </button>
                    </div>
                `;
                revisionLog.appendChild(li);
            });

            revisionTitle.textContent = `Pause #${breakId}`;
            revisionsPanel.hidden = false;
        }

        async function loadRevisions(breakId) {
            try {
                const data = await apiRequest(`/api/breaks/${breakId}/revisions`);
                renderRevisions(data.revisions || [], breakId);
            } catch (error) {
                setMessage(error.message, "error");
            }
        }

        async function restoreRevision(revisionId, breakId) {
            try {
                await apiRequest(`/api/revisions/${revisionId}/restore`, { method: "POST" });
                setMessage("Revision wurde wiederhergestellt.");
                await loadBreaks();
                await loadRevisions(breakId);
            } catch (error) {
                setMessage(error.message, "error");
            }
        }

        function attachEventListeners() {
            createForm.addEventListener("submit", handleCreate);
            createForm.addEventListener("input", () => validateCreate({ allowIncomplete: true }));
            breaksBody.addEventListener("click", handleRowAction);
            breaksBody.addEventListener("input", (event) => {
                const row = event.target.closest("tr");
                if (!row) return;
                validateRow(row, { allowIncomplete: true });
            });
            revisionLog.addEventListener("click", async (event) => {
                const button = event.target.closest("button");
                if (!button || button.dataset.action !== "restore") return;
                const revisionId = Number(button.dataset.revisionId);
                const breakId = Number(revisionTitle.textContent.replace(/\D+/g, ""));
                if (!revisionId || !breakId) return;
                await restoreRevision(revisionId, breakId);
            });
            revisionsCloseBtn.addEventListener("click", () => {
                revisionsPanel.hidden = true;
                revisionLog.innerHTML = "";
            });
        }

        attachEventListeners();
        loadBreaks();
        startActiveHighlightTimer();
    </script>
</body>
</html>
